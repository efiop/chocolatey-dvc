name: Build package
on: [push, pull_request]
jobs:
  windows:
    runs-on: windows-2019
    steps:
    - uses: actions/checkout@v1
    - name: Set up Python 3.8
      uses: actions/setup-python@v1
      with:
        python-version: 3.8
    - name: Build
      shell: cmd
      run: choco pack -v
    - name: Install
      shell: cmd
      run: choco install dvc --debug --verbose --source "'.;https://community.chocolatey.org/api/v2/'"
    - name: Test
      shell: cmd
      run: dvc doctor
    - name: Publish
      if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}
      shell: bash
      env:
        CHOCO_API_KEY: ${{ secrets.CHOCO_API_KEY }}
      run: |
        choco apikey --key $CHOCO_API_KEY --source https://push.chocolatey.org/
        choco push dvc*.nupkg --source https://push.chocolatey.org/
